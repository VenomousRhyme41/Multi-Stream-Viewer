<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Stream Viewer</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&family=Roboto:wght@400;500&family=Oswald:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="https://github.githubassets.com/images/icons/emoji/unicode/1f4fa.png" type="image/png">
    <style>
        :root {
            --active-color: #00FF9D;
            --bg-color: #0a0a0a;
            --card-color: #1a1a1a;
            --text-color: #e0e0e0;
            --border-color: #333;
            --button-bg: #333;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            scrollbar-width: none;
        }
        *::-webkit-scrollbar {
            display: none;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Roboto', sans-serif;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }
        .header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            position: relative;
        }
        h1 {
            margin: 0;
            color: var(--active-color);
            font-weight: 600;
            font-size: 2.5rem;
            font-family: 'Montserrat', sans-serif;
            text-align: center;
            letter-spacing: 1px;
        }
        .global-controls {
            position: absolute;
            right: 0;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .global-btn {
            padding: 8px 15px;
            background-color: var(--button-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            font-size: 14px;
        }
        .global-btn:hover {
            background-color: rgba(0, 255, 157, 0.2);
        }
        .separator {
            color: var(--border-color);
            font-weight: bold;
            padding: 0 5px;
        }
        .container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: auto;
            gap: 15px;
            max-width: 1800px;
            margin: 0 auto;
            width: 95%;
            flex-grow: 1;
            margin-bottom: 10px;
        }
        .container.two-streams {
            grid-template-columns: repeat(2, 1fr);
        }
        .container.three-streams {
            grid-template-columns: repeat(3, 1fr);
        }
        .container.four-streams {
            grid-template-columns: repeat(2, 1fr);
        }
        .stream-wrapper {
            position: relative;
            background-color: var(--card-color);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s ease;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            min-height: 300px;
        }
        .stream-wrapper.loaded {
            min-height: auto;
        }
        .stream-wrapper.active {
            border: 2px solid var(--active-color);
            box-shadow: 0 0 30px rgba(0, 255, 157, 0.3);
        }
        .stream-wrapper.hidden {
            display: none;
        }
        .stream-input {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 400px;
            z-index: 10;
            background-color: rgba(30, 30, 30, 0.95);
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        .stream-input input {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 15px;
            background-color: var(--button-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            border-radius: 8px;
            font-size: 15px;
        }
        .stream-input button {
            padding: 12px 25px;
            background-color: var(--active-color);
            color: #111;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 15px;
            width: 100%;
        }
        .stream-iframe {
            width: 100%;
            height: 100%;
            display: none;
            border: none;
            flex-grow: 1;
            overflow: hidden;
        }
        .kick-iframe {
            transform: scale(0.8);
            transform-origin: top center;
            width: 125%;
            height: 125%;
            margin-left: -12.5%;
        }
        .stream-controls {
            display: none;
            padding: 8px 12px;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: space-between;
        }
        .stream-info {
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-right: 10px;
            flex: 1;
            font-family: 'Oswald', sans-serif;
            letter-spacing: 0.5px;
        }
        .stream-buttons {
            display: flex;
            gap: 8px;
        }
        .control-btn {
            padding: 6px 12px;
            background-color: var(--button-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            font-size: 12px;
        }
        .control-btn:hover {
            background-color: rgba(0, 255, 157, 0.2);
        }
        .control-btn.active {
            background-color: var(--active-color);
            color: #111;
            border-color: transparent;
        }
        .theater-mode-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            padding: 8px 15px;
            background-color: var(--button-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            font-size: 14px;
        }
        .theater-mode-btn:hover {
            background-color: rgba(0, 255, 157, 0.2);
        }
        .exit-theater-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            padding: 8px 15px;
            background-color: var(--button-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            font-size: 14px;
        }
        .exit-theater-btn:hover {
            background-color: rgba(0, 255, 157, 0.2);
        }
        @media (max-width: 1200px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }
            .global-controls {
                position: static;
            }
            .container.three-streams {
                grid-template-columns: repeat(2, 1fr);
            }
            .container.three-streams .stream-wrapper:nth-child(3) {
                grid-column: 1 / -1;
            }
        }
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            .container.two-streams,
            .container.three-streams,
            .container.four-streams {
                grid-template-columns: 1fr;
            }
        }
        body.theater-mode {
            padding: 0;
            overflow: hidden;
            height: 100vh;
        }
        body.theater-mode .header,
        body.theater-mode .stream-input,
        body.theater-mode .stream-controls {
            display: none;
        }
        body.theater-mode .container {
            height: 100vh;
            width: 100%;
            max-width: 100%;
            margin: 0;
            gap: 0;
            padding: 0;
        }
        body.theater-mode .stream-wrapper {
            border-radius: 0;
            height: 100%;
        }
        body.theater-mode .stream-iframe {
            display: block !important;
        }
        body.theater-mode .stream-wrapper:not(.loaded) {
            display: none;
        }
        body.theater-mode.two-streams .container {
            grid-template-columns: repeat(2, 1fr);
        }
        body.theater-mode.three-streams .container {
            grid-template-columns: repeat(3, 1fr);
        }
        body.theater-mode.four-streams .container {
            grid-template-columns: repeat(2, 1fr);
        }
        @media (max-width: 768px) {
            body.theater-mode .container {
                grid-template-columns: 1fr !important;
                grid-template-rows: 1fr;
            }
            body.theater-mode .stream-wrapper {
                height: 100vh;
            }
            body.theater-mode.two-streams .stream-wrapper:nth-child(1) {
                height: 50vh;
            }
            body.theater-mode.two-streams .stream-wrapper:nth-child(2) {
                height: 50vh;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Multi-Stream Viewer</h1>
        <div class="global-controls">
            <button class="global-btn" id="streamLayoutBtn" onclick="toggleStreamLayout()">4 Streams</button>
            <button class="global-btn" onclick="toggleTheaterMode()">Theater Mode</button>
            <span class="separator">|</span>
            <button class="global-btn" onclick="resetAll()">Reset All Streams</button>
        </div>
    </div>
    
    <div class="container" id="streamContainer">
        <div class="stream-wrapper">
            <div class="stream-input">
                <input type="text" placeholder="Paste stream URL or embed code" class="src-input">
                <button onclick="loadStream(this)">Load Stream</button>
            </div>
            <iframe class="stream-iframe" allowfullscreen></iframe>
            <div class="stream-controls">
                <div class="stream-info"></div>
                <div class="stream-buttons">
                    <button class="control-btn audio-btn" onclick="toggleAudio(this)">Audio ON</button>
                    <button class="control-btn" onclick="resetStream(this)">Reset</button>
                </div>
            </div>
        </div>
        
        <div class="stream-wrapper">
            <div class="stream-input">
                <input type="text" placeholder="Paste stream URL or embed code" class="src-input">
                <button onclick="loadStream(this)">Load Stream</button>
            </div>
            <iframe class="stream-iframe" allowfullscreen></iframe>
            <div class="stream-controls">
                <div class="stream-info"></div>
                <div class="stream-buttons">
                    <button class="control-btn audio-btn" onclick="toggleAudio(this)">Audio ON</button>
                    <button class="control-btn" onclick="resetStream(this)">Reset</button>
                </div>
            </div>
        </div>
        
        <div class="stream-wrapper">
            <div class="stream-input">
                <input type="text" placeholder="Paste stream URL or embed code" class="src-input">
                <button onclick="loadStream(this)">Load Stream</button>
            </div>
            <iframe class="stream-iframe" allowfullscreen></iframe>
            <div class="stream-controls">
                <div class="stream-info"></div>
                <div class="stream-buttons">
                    <button class="control-btn audio-btn" onclick="toggleAudio(this)">Audio ON</button>
                    <button class="control-btn" onclick="resetStream(this)">Reset</button>
                </div>
            </div>
        </div>
        
        <div class="stream-wrapper">
            <div class="stream-input">
                <input type="text" placeholder="Paste stream URL or embed code" class="src-input">
                <button onclick="loadStream(this)">Load Stream</button>
            </div>
            <iframe class="stream-iframe" allowfullscreen></iframe>
            <div class="stream-controls">
                <div class="stream-info"></div>
                <div class="stream-buttons">
                    <button class="control-btn audio-btn" onclick="toggleAudio(this)">Audio ON</button>
                    <button class="control-btn" onclick="resetStream(this)">Reset</button>
                </div>
            </div>
        </div>
    </div>

    <button id="exitTheaterBtn" class="exit-theater-btn" style="display: none;" onclick="toggleTheaterMode()">Exit Theater</button>

    <script>
        const domain = window.location.hostname;
        let activeAudioWrapper = null;
        let isTheaterMode = false;
        let streamLayout = 4;

        function toggleTheaterMode() {
            isTheaterMode = !isTheaterMode;
            document.body.classList.toggle('theater-mode', isTheaterMode);
            document.getElementById('exitTheaterBtn').style.display = isTheaterMode ? 'block' : 'none';
            document.querySelector('.theater-mode-btn').style.display = isTheaterMode ? 'none' : 'block';
            
            if (isTheaterMode) {
                document.querySelectorAll('.stream-wrapper').forEach(wrapper => {
                    const iframe = wrapper.querySelector('.stream-iframe');
                    if (iframe.src) {
                        wrapper.classList.add('loaded');
                        iframe.style.display = 'block';
                    } else {
                        wrapper.classList.remove('loaded');
                    }
                });
                
                const loadedCount = document.querySelectorAll('.stream-wrapper.loaded').length;
                document.body.classList.remove('two-streams', 'three-streams', 'four-streams');
                
                if (loadedCount <= 2) {
                    document.body.classList.add('two-streams');
                } else if (loadedCount === 3) {
                    document.body.classList.add('three-streams');
                } else {
                    document.body.classList.add('four-streams');
                }
            } else {
                updateStreamLayout();
                document.body.classList.remove('two-streams', 'three-streams', 'four-streams');
            }
        }

        function toggleStreamLayout() {
            streamLayout = streamLayout === 4 ? 2 : (streamLayout === 2 ? 3 : 4);
            updateStreamLayout();
            document.getElementById('streamLayoutBtn').textContent = `${streamLayout} Streams`;
        }
        
        function updateStreamLayout() {
            const container = document.getElementById('streamContainer');
            const streamWrappers = document.querySelectorAll('.stream-wrapper');
            
            container.classList.remove('two-streams', 'three-streams', 'four-streams');
            
            if (streamLayout === 2) {
                container.classList.add('two-streams');
                streamWrappers.forEach((wrapper, index) => {
                    wrapper.classList.toggle('hidden', index >= 2);
                });
            } else if (streamLayout === 3) {
                container.classList.add('three-streams');
                streamWrappers.forEach((wrapper, index) => {
                    wrapper.classList.toggle('hidden', index >= 3);
                });
            } else {
                streamWrappers.forEach(wrapper => {
                    wrapper.classList.remove('hidden');
                });
            }
        }

        function resetStream(button) {
            const wrapper = button.closest('.stream-wrapper');
            const inputContainer = wrapper.querySelector('.stream-input');
            const iframe = wrapper.querySelector('.stream-iframe');
            const controls = wrapper.querySelector('.stream-controls');
            const info = wrapper.querySelector('.stream-info');
            const audioBtn = wrapper.querySelector('.audio-btn');
            
            wrapper.classList.remove('active', 'loaded');
            inputContainer.style.display = '';
            iframe.style.display = 'none';
            controls.style.display = 'none';
            iframe.src = '';
            info.textContent = '';
            
            wrapper.querySelector('.src-input').value = '';
            audioBtn.textContent = 'Audio ON';
            audioBtn.classList.remove('active');
            iframe.classList.remove('kick-iframe');
            
            if (wrapper === activeAudioWrapper) {
                activeAudioWrapper = null;
            }
        }
        
        function detectPlatform(url) {
            if (!url) return null;
            url = url.toLowerCase();
            if (url.includes('youtube.com') || url.includes('youtu.be')) return 'youtube';
            if (url.includes('twitch.tv')) return 'twitch';
            if (url.includes('kick.com')) return 'kick';
            if (url.includes('rumble.com')) return 'rumble';
            if (url.includes('x.com') || url.includes('twitter.com')) return 'twitter';
            return null;
        }
        
        function extractSrcFromIframe(iframeCode) {
            const srcMatch = /src="([^"]*)"/.exec(iframeCode);
            return srcMatch ? srcMatch[1] : null;
        }
        
        function getEmbedUrl(url) {
            if (!url) return null;
            
            if (url.includes('<iframe') && url.includes('src="')) {
                return extractSrcFromIframe(url);
            }
            
            const platform = detectPlatform(url);
            const streamId = extractStreamId(url, platform);
            
            if (!streamId || !platform) return null;
            
            switch(platform) {
                case 'youtube':
                    return `https://www.youtube.com/embed/${streamId}?autoplay=1&mute=1`;
                case 'twitch':
                    if (streamId.startsWith('v=')) {
                        return `https://player.twitch.tv/?video=${streamId.substring(2)}&parent=${domain}`;
                    }
                    return `https://player.twitch.tv/?channel=${streamId}&parent=${domain}&autoplay=true`;
                case 'kick':
                    return `https://player.kick.com/${streamId}`;
                case 'rumble':
                    return `https://rumble.com/embed/${streamId}/?pub=4`;
                case 'twitter':
                    return null;
                default:
                    return null;
            }
        }
        
        function extractStreamId(url, platform) {
            try {
                if (!url || !platform) return null;
                
                const cleanUrl = url.toLowerCase()
                    .replace(/(https?:\/\/)?(www\.)?/, '')
                    .split('?')[0]
                    .replace(/\/+$/, '');
                
                switch(platform) {
                    case 'youtube':
                        if (url.includes('youtu.be/')) {
                            return url.split('youtu.be/')[1].split('?')[0].split('/')[0];
                        }
                        const youtubeId = new URL(url).searchParams.get('v') || 
                                      url.split('embed/')[1]?.split('?')[0] || 
                                      url.split('v=')[1]?.split('&')[0];
                        return youtubeId;
                    case 'twitch':
                        if (url.includes('/videos/')) {
                            return 'v=' + cleanUrl.split('twitch.tv/videos/')[1];
                        }
                        return cleanUrl.split('twitch.tv/')[1].split('/')[0];
                    case 'kick':
                        if (url.includes('player.kick.com')) {
                            return cleanUrl.split('player.kick.com/')[1].split('/')[0];
                        }
                        return cleanUrl.split('kick.com/')[1].split('/')[0];
                    case 'rumble':
                        if (url.includes('embed/')) {
                            return cleanUrl.split('rumble.com/embed/')[1].split('/')[0];
                        }
                        return null;
                    default:
                        return null;
                }
            } catch {
                return null;
            }
        }
        
        function loadStream(button) {
            const wrapper = button.closest('.stream-wrapper');
            const input = wrapper.querySelector('.src-input');
            const iframe = wrapper.querySelector('.stream-iframe');
            const inputContainer = wrapper.querySelector('.stream-input');
            const controls = wrapper.querySelector('.stream-controls');
            const info = wrapper.querySelector('.stream-info');
            
            if (!input.value.trim()) {
                alert('Please enter a valid stream URL or embed code');
                return;
            }
            
            const inputValue = input.value.trim();
            const embedUrl = getEmbedUrl(inputValue);
            const platform = detectPlatform(inputValue);
            
            if (!embedUrl && platform !== 'twitter') {
                alert('Invalid stream format. Supported: YouTube, Twitch, Kick, Rumble URLs or embed codes');
                return;
            }
            
            if (platform === 'twitter') {
                info.textContent = "Twitter/X streams can't be embedded directly";
                return;
            }
            
            iframe.src = embedUrl;
            iframe.style.display = 'block';
            inputContainer.style.display = 'none';
            controls.style.display = 'flex';
            info.textContent = '';
            wrapper.classList.add('loaded');
            
            if (embedUrl.includes('kick.com')) {
                iframe.classList.add('kick-iframe');
            } else {
                iframe.classList.remove('kick-iframe');
            }
            
            if (embedUrl.includes('youtube.com')) {
                const videoId = extractStreamId(embedUrl, 'youtube');
                if (videoId) {
                    fetchYouTubeTitle(videoId)
                        .then(title => {
                            if (title) {
                                info.textContent = title;
                            }
                        });
                }
            } else if (embedUrl.includes('rumble.com')) {
                info.textContent = 'Rumble Stream';
            }
            
            setTimeout(() => {
                muteIframe(iframe);
                if (wrapper === activeAudioWrapper) {
                    unmuteIframe(iframe);
                }
            }, 3000);
        }
        
        async function fetchYouTubeTitle(videoId) {
            const response = await fetch(`https://noembed.com/embed?url=https://www.youtube.com/watch?v=${videoId}`);
            if (!response.ok) return null;
            const data = await response.json();
            return data.title || null;
        }
        
        function toggleAudio(button) {
            const wrapper = button.closest('.stream-wrapper');
            const iframe = wrapper.querySelector('.stream-iframe');
            
            if (wrapper === activeAudioWrapper) {
                wrapper.classList.remove('active');
                button.classList.remove('active');
                button.textContent = 'Audio ON';
                muteIframe(iframe);
                activeAudioWrapper = null;
                return;
            }
            
            muteAll();
            
            setTimeout(() => {
                wrapper.classList.add('active');
                button.classList.add('active');
                button.textContent = 'Audio ACTIVE';
                activeAudioWrapper = wrapper;
                unmuteIframe(iframe);
            }, 100);
        }
        
        function muteAll() {
            document.querySelectorAll('.stream-iframe').forEach(iframe => {
                muteIframe(iframe);
            });
            
            document.querySelectorAll('.stream-wrapper').forEach(wrapper => {
                wrapper.classList.remove('active');
                const audioBtn = wrapper.querySelector('.audio-btn');
                if (audioBtn) {
                    audioBtn.classList.remove('active');
                    audioBtn.textContent = 'Audio ON';
                }
            });
        }
        
        function muteIframe(iframe) {
            if (!iframe.contentWindow || !iframe.src) return;
            
            try {
                if (iframe.src.includes('youtube.com')) {
                    iframe.contentWindow.postMessage(JSON.stringify({
                        event: 'command',
                        func: 'mute',
                        args: []
                    }), '*');
                } else if (iframe.src.includes('twitch.tv')) {
                    iframe.contentWindow.postMessage(JSON.stringify({
                        method: 'setVolume',
                        value: 0
                    }), '*');
                } else if (iframe.src.includes('rumble.com')) {
                    iframe.contentWindow.postMessage(
                        JSON.stringify({ method: "setVolume", value: 0 }),
                        "*"
                    );
                }
            } catch {}
        }
        
        function unmuteIframe(iframe) {
            if (!iframe.contentWindow || !iframe.src) return;
            
            try {
                if (iframe.src.includes('youtube.com')) {
                    iframe.contentWindow.postMessage(JSON.stringify({
                        event: 'command',
                        func: 'unMute',
                        args: []
                    }), '*');
                    iframe.contentWindow.postMessage(JSON.stringify({
                        event: 'command',
                        func: 'setVolume',
                        args: [100]
                    }), '*');
                } else if (iframe.src.includes('twitch.tv')) {
                    iframe.contentWindow.postMessage(JSON.stringify({
                        method: 'setVolume',
                        value: 1
                    }), '*');
                } else if (iframe.src.includes('rumble.com')) {
                    iframe.contentWindow.postMessage(
                        JSON.stringify({ method: "setVolume", value: 1 }),
                        "*"
                    );
                }
            } catch {}
        }
        
        function resetAll() {
            document.querySelectorAll('.stream-wrapper').forEach(wrapper => {
                const inputContainer = wrapper.querySelector('.stream-input');
                const iframe = wrapper.querySelector('.stream-iframe');
                const controls = wrapper.querySelector('.stream-controls');
                const info = wrapper.querySelector('.stream-info');
                const audioBtn = wrapper.querySelector('.audio-btn');
                
                wrapper.classList.remove('active', 'loaded');
                inputContainer.style.display = '';
                iframe.style.display = 'none';
                controls.style.display = 'none';
                iframe.src = '';
                info.textContent = '';
                
                wrapper.querySelector('.src-input').value = '';
                audioBtn.textContent = 'Audio ON';
                audioBtn.classList.remove('active');
                iframe.classList.remove('kick-iframe');
            });
            
            activeAudioWrapper = null;
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.stream-controls').forEach(controls => {
                controls.style.display = 'none';
            });
            document.getElementById('exitTheaterBtn').style.display = 'none';
            updateStreamLayout();
        });
    </script>
</body>
</html>
